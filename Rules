#!/usr/bin/env ruby

compile /archives/ do
	rep.filter :erb
	layout 'default'
end

compile /\/(home|projects|about)/ do
	rep.filter :erb
	rep.filter :redcloth
	layout 'default'
end

compile /(rss|atom)/ do
	rep.filter :erb
end

compile '/css/*' do
	filter :sass, {
    :load_paths => [Dir.pwd+"/content/css"],
    :full_exception => true,
    :line_numbers => true
  }
end

compile 'sitemap' do
	rep.filter :erb
end

compile /\/(js\/.+?)/ do
	# do nothing
end

	
compile '*' do
	if item[:filters_pre] && !item[:filters_pre].empty? then
		item[:filters_pre].each do |f|
			rep.filter f.to_sym
		end
	else
		rep.filter :redcloth
	end
	layout 'default'
end

route /\/tags\/.+?-(atom|rss)/ do
	item.identifier.gsub(/(.+)-(rss|atom)\/$/, '\1/\2') + '.xml'
end

route '/(atom|rss)/' do
	item.identifier.gsub(/\/$/, '') + '.xml'
end

route 'css/*' do
	item.identifier.gsub(/\/$/, '') + '.css'
end

route 'sitemap' do
	item.identifier.gsub(/\/$/, '') + '.xml'
end

route '/js/*' do
	item.identifier.gsub(/\/$/, '') + '.js'
end

route '*' do
  item.identifier + 'index.html'
end

layout '*', :erb
